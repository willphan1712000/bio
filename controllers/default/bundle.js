(()=>{"use strict";function e(e,a,o,l){const r=arguments.length;return 1===r?new t(e):2===r?new i(e,a):3===r?new n(e,a,o):4===r?new s(e,a,o,l):void 0}function t(e){this.ele1=e,this.passShowHide=function(){return new l(this.ele1)},this.transform=function(){return new h(this.ele1,void 0,void 0)},this.addSpinner=function(){return new o(this.ele1)},this.format=function(){return new Format(this.ele1)}}function i(e,t){this.ele1=e,this.ele2=t,this.toggle=function(){return new c(this.ele1,this.ele2)},this.upload=function(){return new r(this.ele1,this.ele2)},this.copyToClipboard=function(){return new u(this.ele1,this.ele2)}}function n(e,t,i){this.ele1=e,this.ele2=t,this.ele3=i;const n=this;this.transform=function(){return new h(n.ele1,n.ele2,n.ele3)},this.table=function(){return new a(this.ele1,this.ele2,this.ele3)}}function s(e,t,i,n){this.ele1=e,this.ele2=t,this.ele3=i,this.ele4=n}function a(e,t,i){this.location=e,this.header=t,this.data=i,this.create=function(){$(this.location).append("<table><tr></tr></table>");for(const e in this.header)this.header.hasOwnProperty(e)&&$(this.location+" table tr").append(`<th>${this.header[e]}</th>`);let e=0;for(const t in this.data){e++;let i=`<tr><th>${e}</th>`,n=this.data[t];for(const e in n)i+=`<th>${n[e]}</th>`;i+="</tr>",$(this.location+" table").append(i)}return this}}function o(e){this.ele1=e,this.show=function(){return $(this.ele1+" .loader").addClass("spinner"),this},this.hide=function(){return $(this.ele1+" .loader").removeClass("spinner"),this},this.singleSpinner=function(){let e=document.createElement("style");return e.textContent='\n        .spinner {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n        }\n        .spinner::after {\n            content: "";\n            position: absolute;\n            width: 16px;\n            height: 16px;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            margin: auto;\n            border: 4px solid transparent;\n            border-top-color: #000;\n            border-radius: 50%;\n            animation: spinner 1s linear infinite;\n        }\n        @keyframes spinner {\n            from {\n                transform: rotate(0turn);\n            }\n            to {\n                transform: rotate(1turn);\n            }\n        }',document.head.appendChild(e),$(this.ele1).append('<div class="loader"></div>'),$(this.ele1).css("position","relative"),this},this.gradientSpinner=function(){return $(this.ele1).append('<div class="loader spinner"></div>'),this}}function l(e){this.input=e;const t=$(this.input);this.run=function(){const i=t.innerWidth(),n=t.innerHeight();return t.after('<div style="position: relative;"></div>'),$(e+" + div").append(t.html(self)),t.after(`<i class="fa-solid fa-eye eye" style="position: absolute;left: ${i-21}px; top: ${(n-16)/2}px; cursor: pointer; color: #333;"></i>`),$(this.input).next().click((function(){"password"===t.attr("type")?(t.attr("type","text"),$(this).css({color:"green"})):(t.attr("type","password"),$(this).css({color:"#333"}))})),this}}function r(e,t){this.ele1=e,this.ele2=t;const i=$(this.ele1),n=$(this.ele2);this.openFile=function(){return i.click((e=>{e.stopPropagation(),n.click()})),this},this.fileHandling=function(e,t){const{target:i}=e,n=i.files[0];if(n){const e=new FileReader;e.readAsDataURL(n),e.onload=function(e){const i=document.createElement("img");i.src=e.target.result,i.onload=function(e){t(e.target.src)}}}},this.drawImage=function(e,t,i,n,s,a,o,l,r){const c=document.createElement("canvas");c.width=a,c.height=o;const h=c.getContext("2d"),u=a/l,d=o/r;let f=t*u,m=i*d,p=e.width*u,g=e.height*d,_=e.width*u*n,$=e.height*d*n;return h.translate(f+p/2,m+g/2),h.rotate(s*Math.PI/180),h.drawImage(e,-_/2,-$/2,_,$),h.canvas.toDataURL(e).split(",")[1]}}function c(e,t){this.ele1=e,this.ele2=t;const i=this;this.run=function(){return $(this.ele1).click((function(e){e.stopPropagation(),$(e.currentTarget).toggleClass(i.ele2),$("body").click((function(t){t.target.classList.contains(i.ele2)||($(e.currentTarget).removeClass(i.ele2),$("body").off("click"))}))})),this},this.custom=function(){$(this.ele1).click((function(e){e.stopPropagation(),$(e.currentTarget).next().toggleClass(i.ele2)}))}}function h(e,t,i){this.ele1=e,this.ele2=t,this.signal=i,this.collided=!1,this.x=0,this.y=0,this.scale=1,this.angle=0;const n=$(this.ele1),s=($(this.ele2),this);this.setValue=function(e,t,i,n){this.x=void 0!==e?e:this.x,this.y=void 0!==t?t:this.y,this.scale=void 0!==i?i:this.scale,this.angle=void 0!==i?n:this.angle},this.performTransform=function(e,t,i,s){n.css({transform:`translate(${e}px, ${t}px) scale(${i}) rotate(${s}deg)`})},this.exportData=function(){return[this.x,this.y,this.scale,this.angle]},this.isCollided=function(){return this.collided},this.setIsCollided=function(e){this.collided=e},this.draggable=function(){let e,t,i,a;return n.on("touchstart",(function(o){o.preventDefault(),o.stopPropagation(),e=o.touches[0].clientX,t=o.touches[0].clientY;let[l,r,c,h]=s.exportData();n.on("touchmove",(function(n){i=n.touches[0].clientX-e,a=n.touches[0].clientY-t,e=n.touches[0].clientX,t=n.touches[0].clientY,l+=i,r+=a,s.performTransform(l,r,c,h)})),n.on("touchend",(function(){n.off("touchmove",null),n.off("touchend",null),s.setValue(l,r,void 0,void 0)}))})),this},this.distort=function(){return n.on("touchstart",(function(e){let t,i,a,o,l,r,c,h,u,d,f;if(e.preventDefault(),e.stopPropagation(),2===e.touches.length){t=e.touches[0].clientX,i=e.touches[0].clientY,a=e.touches[1].clientX,o=e.touches[1].clientY,l=a-t,r=o-i,u=Math.atan2(l,r);let[m,p,g,_]=s.exportData();n.on("touchmove",(function(e){t=e.touches[0].clientX,i=e.touches[0].clientY,a=e.touches[1].clientX,o=e.touches[1].clientY,c=a-t,h=o-i,d=Math.atan2(c,h),_-=180*(d-u)/Math.PI,f=Math.sqrt(c*c+h*h)/Math.sqrt(l*l+r*r),g*=f,s.performTransform(m,p,g,_),l=c,r=h,u=d})),n.on("touchend",(function(){n.off("touchmove",null),n.off("touchend",null),s.setValue(void 0,void 0,g,_)}))}})),this},this.terminate=function(){return n.off("touchstart",null),$(document).off("touchmove",null),$(document).off("touchend",null),this}}function u(e,t){this.ele1=e,this.ele2=t;const i=this;this.run=function(e){$(this.ele2).click((()=>{navigator.clipboard.writeText(i.ele1),e()}))}}function d(e,t,i,n,s){const a=arguments.length;return 1===a?new f(e):2===a?new m(e,t):3===a?new p(e,t,i):4===a?new g(e,t,i,n):5===a?new _(e,t,i,n,s):void 0}function f(e){this.ele1=e,this.googleAPI=function(e){return new v(e)}}function m(e,t){this.ele1=e,this.ele2=t}function p(e,t,i){this.ele1=e,this.ele2=t,this.ele3=i}function g(e,t,i,n){this.ele1=e,this.ele2=t,this.ele3=i,this.ele4=n}function _(e,t,i,n,s){this.ele1=e,this.ele2=t,this.ele3=i,this.ele4=n,this.ele5=s,this.signup=function(){return new w(this.ele1,this.ele2,this.ele3,this.ele4,this.ele5)},this.formValidate=function(){return new y(this.ele1,this.ele2,this.ele3,this.ele4,this.ele5)}}function v(e){this.API_KEY=e,this.autocomplete;const t=this;this.runGoogleMapsAPI=function(e){let i=document.createElement("script");i.src=`https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&key=${t.API_KEY}`,document.body.appendChild(i),i.addEventListener("load",(()=>{e=document.querySelector(e),t.autocomplete=new google.maps.places.Autocomplete(e,{types:["geocode"]}),google.maps.event.addListener(t.autocomplete,"place_changed",(function(){t.autocomplete.getPlace()}))}))}}function y(e,t,i,n,s){this.input=e,this.msg=t,this.success=i,this.error=n,this.regex=s,this.isValid=!0;const a=this;this.setValidity=function(e){this.isValid=e},this.getValidity=function(){return this.isValid},this.phoneFormat=function(){$(this.input).on("input",(function(e){let t=e.target.value.replace(/\D/g,""),i="";for(let e=0;e<t.length;e++)3!==e&&6!==e||(i+="-"),i+=t[e];e.target.value=i}))},this.run=function(){const e=this.regex;return $(this.input).on("input",(function(t){""!==t.target.value?e.test(t.target.value)?(a.setValidity(!0),$(a.msg).html(a.success)):(a.setValidity(!1),$(a.msg).html(a.error)):($(a.msg).html(""),a.setValidity(!0))})),this}}function w(e,t,i,n,s){this.username=e,this.email=t,this.password=i,this.error=n,this.submit=s;const a=$(this.username),o=$(this.email),l=$(this.password),r=$(this.submit),c=$(this.error),h=this;this.run=function(){r.click((function(e){e.preventDefault(),h.isFillAll(a.val(),o.val(),l.val())?(c.html("Please fill in all information!"),h.shakingErrorMsg(c)):h.isValidEmail(o.val())?h.isValidPassword(l.val())?(c.html(""),$.ajax({url:"/data/signup.php",method:"POST",dataType:"json",data:{username:h.removeSpace(a.val()),email:o.val(),password:l.val()},success:function(e){e[0]?(c.html("The username has already been taken!"),h.shakingErrorMsg(c)):e[1]?e[2]&&e[3]&&e[4]&&e[5]?h.createFiles(h.removeSpace(a.val()),(function(e){e&&h.signUpSuccess(".signupChild","inactive",".signupSuccess","active")})):(c.html("There is an error, try again!"),h.shakingErrorMsg(c)):(c.html("The email is not valid!"),h.shakingErrorMsg(c))},error:function(){c.html("The server has internal error!"),h.shakingErrorMsg(c)}})):(c.html("The password is not valid!"),h.shakingErrorMsg(c)):(c.html("The email is not valid!"),h.shakingErrorMsg(c))}))},this.isFillAll=function(e,t,i){return!(e&&t&&i)},this.isValidEmail=function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},this.isValidPassword=function(e){let t,i=!1,n=!1,s=!1,a=!0,o=!1;e.length>=12&&(i=!0);for(let i=0;i<e.length;i++)if(t=e[i].charCodeAt(),t>=65&&t<=90&&(n=!0),t>=48&&t<=57&&(s=!0),t>=33&&t<=47&&(a=!0),n&&s&&a){o=!0;break}if(i&&o)return o},this.removeSpace=function(e){let t="";for(let i=0;i<e.length;i++)" "!==e[i]&&(t+=e[i]);return t},this.shakingErrorMsg=function(e){var t=window.requestAnimationFrame||window.mozrequestAnimationFrame||window.webkitrequestAnimationFrame||window.msrequestAnimationFrame,i=0,n=0,s=-2.5;!function a(){i++,((n+=s)<=-15||n>=15)&&(s=-s);const o=t(a);30===i&&(cancelAnimationFrame(o),n=0),e.css({transform:`translateX(${n}px)`})}()},this.signUpSuccess=function(e,t,i,n){$(e).addClass(t),$(i).addClass(n)},this.createFiles=function(e,t){let i={type:"create"};i.username=e,$.ajax({url:"/controllers/default/data/update.php",method:"POST",dataType:"html",contentType:"application/json",data:JSON.stringify(i),success:function(e){t(e)}})}}$(document).ready((function(){switch(type){case"index":e("string"==typeof url?url:"",".shareWindow__link").copyToClipboard().run((()=>{$(".shareWindow__btn.shareWindow__link .check").show(),$(".shareWindow__btn.shareWindow__link .copy").hide(),setTimeout((()=>{$(".shareWindow__btn.shareWindow__link .check").hide(),$(".shareWindow__btn.shareWindow__link .copy").show()}),2e3)})),$(".share__btn.share").click((()=>{$(".shareWindow_parent").addClass("active")})),$(".shareWindow__close").click((()=>{$(".shareWindow_parent").removeClass("active")}));break;case"admin":!function(){const t=document.querySelector(".info__img--location img");let i,n=!1;const s=e(".adminBtn__save").addSpinner().singleSpinner(),a=e(".info__img--choose",".info__img input").upload().openFile();e(".info__img--location",".info__img input").upload().openFile(),$(".info__img input").on("change",(s=>{a.fileHandling(s,(function(s){n=!0,i=e(".info__img--location img").transform().draggable().distort(),t.src=s}))}));d(null).googleAPI("AIzaSyDzVaJBzfYI99plotEoYzCKASerLaeNNGY").runGoogleMapsAPI(".Address #social__info"),e(".countryCode","active").toggle().custom(),"string"==typeof username&&$.ajax({url:"/controllers/default/data/update.php",method:"POST",dataType:"json",data:JSON.stringify({username,type:"getInfo"}),success:function(e){const i=e[0];void 0!==i?($(".info__img .uploadImg__filename").val(i.image),$(".info__name #name").val(i.name),$(".info__org #org").val(i.organization),$(".info__des #des").val(i.description),fetch("/src/module/countryCodes.json").then((e=>e.json())).then((e=>{for(let t=0;t<socialName.length;t++){if("Messenger"===socialName[t])i[socialName[t]]=i[socialName[t]].replace("https://m.me/","");else if("Zalo"===socialName[t])i[socialName[t]]=i[socialName[t]].replace("https://zalo.me/","");else if("Mobile"===socialName[t]||"Work"===socialName[t]){let n,s,a;""===i[socialName[t]]?s=230:(s=i[socialName[t]].split(" ")[0],i[socialName[t]]=i[socialName[t]].split(" ")[1]),n=e[s].dial_code,a=e[s].code,$("."+socialName[t]+" .countryCode").data("index",s),$("."+socialName[t]+" .countryCode > .flag > img").attr("src","/src/module/flags/"+a.toLowerCase()+".png"),$("."+socialName[t]+" .countryCode > .code").html(n)}$("."+socialName[t]+" #social__info").val(i[socialName[t]])}t.src=""===i.image?defaultImgPath:"/user/"+username+"/"+i.image}))):t.src=defaultImgPath}}),$(".adminBtn__delete").click((function(){$(".warning__parent").addClass("active")})),$(".warning__child .btn__back").click((function(){$(".warning__parent").removeClass("active")})),$(".warning__child .btn__confirm").click((function(){let e={type:"deleteToken",token:time,username};$.ajax({url:"/controllers/default/data/update.php",method:"POST",dataType:"html",contentType:"application/json",data:JSON.stringify(e),success:function(e){e&&(window.location.href="/")}})})),$(".adminBtn__index").click((function(){window.location.href=`/${username}`})),$(".info__img--remove").click((function(){let e={type:"avaDelete",username,img:$(".info__img .uploadImg__filename").val()};$.ajax({url:"/controllers/default/data/update.php",method:"POST",data:JSON.stringify(e),dataType:"html",contentType:"application.json",success:function(e){e?t.src=defaultImgPath:location.reload()}})}));const o={};for(let e=0;e<socialName.length;e++)"Mobile"!==socialName[e]&&"Email"!==socialName[e]&&"Messenger"!==socialName[e]&&"Work"!==socialName[e]&&(o[socialName[e]]=d("."+socialName[e]+" #social__info","."+socialName[e]+" span",'<i style="color:green;" class="fa-solid fa-check"></i>','<i style="color:red;" class="fa-solid fa-x"></i>',/^(https?:\/\/)\w*/).formValidate().run());o.Mobile=d(".Mobile #social__info",".Mobile span",'<i style="color:green;" class="fa-solid fa-check"></i>','<i style="color:red;" class="fa-solid fa-x"></i>',/^\d{3}-\d{3}-\d{4}$/).formValidate().run(),o.Mobile.phoneFormat(),o.Work=d(".Work #social__info",".Work span",'<i style="color:green;" class="fa-solid fa-check"></i>','<i style="color:red;" class="fa-solid fa-x"></i>',/^\d{3}-\d{3}-\d{4}$/).formValidate().run(),o.Work.phoneFormat(),o.Zalo=d(".Zalo #social__info",".Zalo span",'<i style="color:green;" class="fa-solid fa-check"></i>','<i style="color:red;" class="fa-solid fa-x"></i>',/^\d{3}\d{3}\d{4}$/).formValidate().run(),o.Email=d(".Email #social__info",".Email span",'<i style="color:green;" class="fa-solid fa-check"></i>','<i style="color:red;" class="fa-solid fa-x"></i>',/^[^\s@]+@[^\s@]+\.[^\s@]+$/).formValidate().run(),o.Messenger=d(".Messenger #social__info",".Messenger span",'<i style="color:green;" class="fa-solid fa-check"></i>','<i style="color:red;" class="fa-solid fa-x"></i>',/^.*$/).formValidate().run(),o.Address=d(".Address #social__info",".Address span",'<i style="color:green;" class="fa-solid fa-check"></i>','<i style="color:red;" class="fa-solid fa-x"></i>',/^.*$/).formValidate().run(),$(".adminBtn__save").click((function(){let e=[];for(let t=0;t<socialName.length;t++)e.push(o[socialName[t]].getValidity());if(e.push(o.Mobile.getValidity()),e.push(o.Work.getValidity()),e.push(o.Email.getValidity()),e.push(o.Messenger.getValidity()),e.push(o.Address.getValidity()),e.every((e=>!0===e))){let e={};if(n){let[n,s,o,l]=i.exportData(),r=a.drawImage(t,n,s,o,l,700,700,$(".info__img--location").width(),$(".info__img--location").height());e.src=r}e.type="info",e.username=username,e.image=$(".info__img .uploadImg__filename").val(),e.name=$(".info__name #name").val(),e.organization=$(".info__org #org").val(),e.description=$(".info__des #des").val();for(let t=0;t<socialName.length;t++)if("Messenger"===socialName[t]){const i=$("."+socialName[t]+" #social__info").val(),n=""===i?"":`https://m.me/${i}`;e[socialName[t]]=n}else if("Zalo"===socialName[t]){const i=$("."+socialName[t]+" #social__info").val(),n=""===i?"":`https://zalo.me/${i}`;e[socialName[t]]=n}else if("Mobile"===socialName[t]||"Work"===socialName[t]){const i=$("."+socialName[t]+" .countryCode").data("index"),n=$("."+socialName[t]+" #social__info").val();e[socialName[t]]=""===n?"":`${i} ${$("."+socialName[t]+" #social__info").val()}`}else e[socialName[t]]=$("."+socialName[t]+" #social__info").val();$.ajax({url:"/controllers/default/data/update.php",method:"POST",data:JSON.stringify(e),dataType:"html",contentType:"application/json",beforeSend:function(){s.show(),$(".adminBtn__save span").css("visibility","hidden")},success:function(e){null!==e&&(s.hide(),$(".adminBtn__save span").css("visibility","visible"),$(".info__img .uploadImg__filename").val(e),n&&i.terminate(),$(".msg").removeClass("active"),$(".successMsg").addClass("active"),setTimeout((()=>{$(".successMsg").removeClass("active"),window.location.href=`/${username}`}),1e3))},error:function(){$(".msg").removeClass("active"),$(".errorMsg").addClass("active"),setTimeout((()=>{location.reload()}),3e3)}})}else $(".msg").removeClass("active"),$(".notValidForm").addClass("active"),setTimeout((()=>{$(".notValidForm").removeClass("active")}),3e3)}))}();break;case"signup":e("#password").passShowHide().run(),e(".passRequirements","dropdown").toggle().run(),d("#username","#email","#password",".signupChild__error",".signupChild__confirm").signup().run();break;case"signin":e("#password").passShowHide().run();break;case"aic":!function(){const t=e("#userData").addSpinner().singleSpinner();$.ajax({url:"/controllers/default/data/update.php",method:"POST",dataType:"json",data:JSON.stringify({type:"getUserInfo"}),beforeSend:function(){t.show()},success:function(i){const n={};for(let e=0;e<i.length;e++)i[e].bioLink=`<a target="_blank" href="/${i[e].username}" style="color: #000;">Bio</a>`,i[e].admin=`<a target="_blank" href="/${i[e].username}/admin" style="color: #000;">Admin</a>`,i[e].delete=`<button value="${i[e].username}">Delete</button>`,n[e]=i[e];let s;e("#userData",{1:"#",2:"Username",3:"Email",4:"Password",5:"Token",6:"Delete Token",7:"Bio",8:"Admin",9:"Delete"},n).table().create(),t.hide(),$("#userData button").click((function(e){$(".warning__parent").addClass("active"),s=e.currentTarget.value})),$(".btn__confirm").click((function(){$.ajax({url:"/controllers/default/data/update.php",method:"POST",dataType:"html",contentType:"application/json",data:JSON.stringify({type:"delete",username:s}),success:function(e){e&&location.reload()}})})),$(".btn__back").click((function(){$(".warning__parent").removeClass("active")}))}})}(),$.ajax({url:"/controllers/default/data/update.php",method:"POST",dataType:"json",data:JSON.stringify({type:"mainPage"}),success:function(e){e&&console.log("Database has been checked and updated")},error:function(){console.log("Error")}});break;case"forgot":case"forgotUsername":break;case"resetPass":e("#password").passShowHide().run(),e("#verifyPassword").passShowHide().run();break;case"restore":$(".btn__ele--restore").click((function(){$.ajax({url:"/controllers/default/data/update.php",method:"POST",dataType:"json",data:JSON.stringify({type:"restoreAccount",username}),success:function(e){e&&(window.location.href="/")},error:function(){}})})),$(".btn__ele--delete").click((function(){$.ajax({url:"/controllers/default/data/update.php",method:"POST",dataType:"html",contentType:"application/json",data:JSON.stringify({type:"delete",username}),success:function(e){e&&(window.location.href="/")},error:function(){}})}))}}))})();